(window.webpackJsonp=window.webpackJsonp||[]).push([[151],{581:function(t,v,a){"use strict";a.r(v);var _=a(19),e=Object(_.a)({},(function(){var t=this,v=t.$createElement,a=t._self._c||v;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"h5-直播"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#h5-直播"}},[t._v("#")]),t._v(" H5 直播")]),t._v(" "),a("p",[t._v("常用视频编码：MPEG、H264、RealVideo、WMV、QuickTime")]),t._v(" "),a("p",[t._v("常用音频编码：PCM、WAV、OGG、APE、AAC、MP3、Vorbis、Opus")]),t._v(" "),a("h3",{attrs:{id:"直播整体流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#直播整体流程"}},[t._v("#")]),t._v(" 直播整体流程")]),t._v(" "),a("p",[t._v("录制->编码->网络传输（推流->服务器处理->CDN 分发）->解码->播放")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("视频采集端：可以是电脑上的音视频输入设备、或手机端的摄像头、或麦克风，目前以移动端手机视频为主。")])]),t._v(" "),a("li",[a("p",[t._v("直播流视频服务端：一台 Nginx 服务器，采集视频录制端传输的视频流(H264/ACC 编码)，由服务器端进行解析编码，推送 RTMP/HLS 格式视频流至视频播放端。")])]),t._v(" "),a("li",[a("p",[t._v("视频播放端：可以是电脑上的播放器（QuickTime Player、VLC），手机端的 native 播放器，还有就是 H5 的 video 标签等，目前还是以手机端的 native 播放器为主。")])])]),t._v(" "),a("h3",{attrs:{id:"直播流"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#直播流"}},[t._v("#")]),t._v(" 直播流")]),t._v(" "),a("p",[t._v("直播流（Live streaming）和静态文件播放的关键差异：")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("点播的目标文件通常位于服务器上，具有一定的播放时长、文件大小。浏览器可以使用渐进式下载，一边下载一边播放")])]),t._v(" "),a("li",[a("p",[t._v("直播不存在播放起点、终点。它表现为一种流的形式，源源不断的从视频采集源通过服务器，传递到客户端")])]),t._v(" "),a("li",[a("p",[t._v("直播流通常是自适应的（adaptive），其码率随着客户端可用带宽的变化，可能变大、变小，以尽可能消除延迟")])])]),t._v(" "),a("blockquote",[a("p",[t._v("参考："),a("a",{attrs:{href:"https://www.cnblogs.com/aixing/p/13327135.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.cnblogs.com/aixing/p/13327135.html"),a("OutboundLink")],1)])]),t._v(" "),a("h2",{attrs:{id:"视频流协议"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#视频流协议"}},[t._v("#")]),t._v(" 视频流协议")]),t._v(" "),a("p",[t._v("HLS 与 RTMP")]),t._v(" "),a("h3",{attrs:{id:"hls"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hls"}},[t._v("#")]),t._v(" HLS")]),t._v(" "),a("p",[t._v("HLS 全称是 HTTP Live Streaming。是一个基于 HTTP 的视频流协议，这是 Apple 提出的直播流协议。")]),t._v(" "),a("p",[t._v("一个提供 HLS 的服务器需要做两件事：")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("编码：以 H.263 格式对图像进行编码，以 MP3 或者 HE-AAC 对声音进行编码，最终打包到 MPEG-2 TS（Transport Stream）容器之中；")])]),t._v(" "),a("li",[a("p",[t._v("分割：把编码好的 TS 文件等长切分成后缀为 ts 的小文件，并生成一个 .m3u8 的纯文本索引文件；")])])]),t._v(" "),a("p",[t._v("HLS 首次连接时，总共的延时：")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("TCP 握手，")])]),t._v(" "),a("li",[a("p",[t._v("m3u8 文件下载，")])]),t._v(" "),a("li",[a("p",[t._v("m3u8 下的 ts 文件下载")])])]),t._v(" "),a("h3",{attrs:{id:"rtmp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rtmp"}},[t._v("#")]),t._v(" RTMP")]),t._v(" "),a("p",[t._v("RTMP (Real Time Messaging Protocol)是 Adobe 公司开发的一套视频直播协议，基于 flash，因此，无法在 ios 的浏览器中使用,但是其实时性较好，延时可以低至两秒。")]),t._v(" "),a("p",[t._v("特性：")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("基于 TCP")])]),t._v(" "),a("li",[a("p",[t._v("浏览器端依赖 Flash 进行播放")])]),t._v(" "),a("li",[a("p",[t._v("2~5 秒的延迟")])])]),t._v(" "),a("p",[t._v("缺点：")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("无法支持移动端 WEB 播放")])]),t._v(" "),a("li",[a("p",[t._v("无法在 iOS 的 H5 页面播放，但是对于 iOS 原生应用是可以自己写解码去解析的")])]),t._v(" "),a("li",[a("p",[t._v("HTML5 video 标签无法播放 RTMP 协议的视频，可以通过 video.js 来实现。")])])]),t._v(" "),a("h3",{attrs:{id:"http-flv"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#http-flv"}},[t._v("#")]),t._v(" HTTP-FLV")]),t._v(" "),a("blockquote",[a("p",[a("a",{attrs:{href:"https://www.cnblogs.com/qianduantuanzhang/p/7795044.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.cnblogs.com/qianduantuanzhang/p/7795044.html"),a("OutboundLink")],1)])]),t._v(" "),a("h3",{attrs:{id:"flv-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#flv-js"}},[t._v("#")]),t._v(" flv.js")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("Bilibli 开源，解析 flv 数据，通过 MSE 封装成 fMP4 喂给 video 标签")])]),t._v(" "),a("li",[a("p",[t._v("编码为 H264+AAC")])]),t._v(" "),a("li",[a("p",[t._v("使用 HTTP 的流式 IO(fetch 或 stream)或 WebSocket 协议流式的传输媒体内容")])]),t._v(" "),a("li",[a("p",[t._v("2~5 秒的延迟，首帧比 RTMP 更快")])])])])}),[],!1,null,null,null);v.default=e.exports}}]);