(window.webpackJsonp=window.webpackJsonp||[]).push([[218],{685:function(e,a,s){"use strict";s.r(a);var v=s(24),t=Object(v.a)({},(function(){var e=this,a=e.$createElement,s=e._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h2",{attrs:{id:"webpack-热更新原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#webpack-热更新原理"}},[e._v("#")]),e._v(" webpack 热更新原理")]),e._v(" "),s("p",[e._v("简答：")]),e._v(" "),s("blockquote",[s("p",[e._v("大概流程是我们用 webpack-dev-server 启动一个服务之后，浏览器和服务端是通过 websocket 进行长连接，webpack 内部实现的 watch 就会监听文件修改，只要有修改就 webpack 会重新打包编译到内存中，然后 webpack-dev-server 依赖中间件 webpack-dev-middleware 和 webpack 之间进行交互，每次热更新都会请求一个携带 hash 值的 json 文件和一个 js，websocket 传递的也是 hash 值，内部机制通过 hash 值检查进行热更新，")])]),e._v(" "),s("h3",{attrs:{id:"webpack-热更新原理-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#webpack-热更新原理-2"}},[e._v("#")]),e._v(" webpack 热更新原理")]),e._v(" "),s("ol",[s("li",[s("p",[e._v("通过 webpack-dev-server 创建两个服务器：提供静态资源的服务（express）和 WebSocket 服务")])]),e._v(" "),s("li",[s("p",[e._v("express server 负责直接提供静态资源的服务（打包后的资源直接被浏览器请求和解析）")])]),e._v(" "),s("li",[s("p",[e._v("socket server 是一个 websocket 的长连接，可以建立本地服务和浏览器的双向通信。当本地文件发生变化时，服务器会立马告知浏览器热更新代码。")])]),e._v(" "),s("li",[s("p",[e._v("当 socket server 监听到对应的模块发生变化时，会生成两个文件.json（manifest 文件）和.js 文件（update chunk）")])]),e._v(" "),s("li",[s("p",[e._v("通过长连接，socket server 可以直接将这两个文件主动发送给客户端（浏览器）")])]),e._v(" "),s("li",[s("p",[e._v("浏览器拿到两个新的文件后，通过 HMR runtime 机制，加载这两个文件，并且针对修改的模块进行更新")])])]),e._v(" "),s("h3",{attrs:{id:"相关知识点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#相关知识点"}},[e._v("#")]),e._v(" 相关知识点")]),e._v(" "),s("p",[e._v("webpack-dev-server：只负责启动服务和前置准备工作")]),e._v(" "),s("p",[e._v("webpack-dev-middleware：所有文件相关的操作都抽离至此，主要是本地文件的编译和输出以及监听")]),e._v(" "),s("p",[e._v("代码改动（生成了一个 Hash 和两个文件）：")]),e._v(" "),s("blockquote",[s("p",[e._v("每次修改代码，紧接着触发重新编译，然后浏览器就会发出 2 次请求。请求的便是本次新生成的 2 个文件。如下：")])]),e._v(" "),s("ol",[s("li",[s("p",[e._v("新的 Hash 值（Hash 值代表每一次编译的标识，本次输出的 Hash 值会被作为下次热更新的标识。）：a61bdd6e82294ed06fa3")])]),e._v(" "),s("li",[s("p",[e._v("新的 JSON 文件（上次输出的 Hash 值会作为本次编译新生成的文件标识）： a93fd735d02d98633356.hot-update.json")])])]),e._v(" "),s("p",[e._v("JSON 文件返回的结果对象中：")]),e._v(" "),s("p",[e._v("h 表示本次新生成的 Hash 值，用于下次文件热更新请求的前缀")]),e._v(" "),s("p",[e._v("c 表示当前要热更新的文件对应的是 index 模块")]),e._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[e._v("新的 JS 文件（上次输出的 Hash 值会作为本次编译新生成的文件标识）：index.a93fd735d02d98633356.hot-update.js")])]),e._v(" "),s("p",[e._v("如果没有任何代码改动：")]),e._v(" "),s("ol",[s("li",[s("p",[e._v("新的 Hash 值：d2e4208eca62aa1c5389")])]),e._v(" "),s("li",[s("p",[e._v("新的 JSON 文件：a61bdd6e82294ed06fa3.hot-update.json")])])])])}),[],!1,null,null,null);a.default=t.exports}}]);