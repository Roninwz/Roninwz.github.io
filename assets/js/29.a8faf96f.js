(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{453:function(t,s,a){t.exports=a.p+"assets/img/jsbridge.80a46746.png"},749:function(t,s,a){"use strict";a.r(s);var e=a(24),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h2",{attrs:{id:"jsbridge"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#jsbridge"}},[t._v("#")]),t._v(" jsbridge")]),t._v(" "),e("p",[t._v("JSBridge 是 Native 代码与 JS 代码的通信桥梁。")]),t._v(" "),e("p",[t._v("目前的一种统一方案是：H5 触发 url scheme->Native 捕获 url scheme->原生分析,执行->原生调用 h5。如下图")]),t._v(" "),e("p",[e("img",{attrs:{src:a(453),alt:"image"}})]),t._v(" "),e("p",[t._v("Web 端和 Native 可以类比于 Client/Server 模式，Web 端调用原生接口时就如同 Client 向 Server 端发送一个请求类似，JSBridge 在此充当类似于 HTTP 协议的角色，实现 JSBridge 主要是两点：")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("将 Native 端原生接口封装成 JavaScript 接口")])]),t._v(" "),e("li",[e("p",[t._v("将 Web 端 JavaScript 接口封装成原生接口")])])]),t._v(" "),e("h3",{attrs:{id:"native-web"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#native-web"}},[t._v("#")]),t._v(" Native->Web")]),t._v(" "),e("p",[t._v("先来说 Native 端调用 Web 端，这个比较简单，JavaScript 作为解释性语言，最大的一个特性就是可以随时随地地通过解释器执行一段 JS 代码，所以可以将拼接的 JavaScript 代码字符串，传入 JS 解析器执行就可以，JS 解析器在这里就是 webView。")]),t._v(" "),e("h3",{attrs:{id:"web-native"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#web-native"}},[t._v("#")]),t._v(" Web->Native")]),t._v(" "),e("p",[t._v("Web 调用 Native 端主要有两种方式")]),t._v(" "),e("ol",[e("li",[t._v("拦截 Webview 请求的 URL Schema")])]),t._v(" "),e("p",[t._v("URL Schema 是类 URL 的一种请求格式，格式如下："),e("code",[t._v("<protocol>://<host>/<path>?<qeury>#fragment")])]),t._v(" "),e("p",[t._v("我们可以自定义 JSBridge 通信的 URL Schema，比如：jsbridge://showToast?text=hello\nNative 加载 WebView 之后，Web 发送的所有请求都会经过 WebView 组件，所以 Native 可以重写 WebView 里的方法，拦截 Web 发起的请求，我们对请求的格式进行判断：")]),t._v(" "),e("p",[t._v("如果符合我们自定义的 URL Schema，对 URL 进行解析，拿到相关操作、操作，进而调用原生 Native 的方法")]),t._v(" "),e("p",[t._v("如果不符合我们自定义的 URL Schema，我们直接转发，请求真正的服务")]),t._v(" "),e("ol",{attrs:{start:"2"}},[e("li",[t._v("向 Webview 中注入 JS API")])]),t._v(" "),e("p",[t._v("这个方法会通过 webView 提供的接口，App 将 Native 的相关接口注入到 JS 的 Context（window）的对象中，一般来说这个对象内的方法名与 Native 相关方法名是相同的，Web 端就可以直接在全局 window 下使用这个全局 JS 对象，进而调用原生端的方法。")]),t._v(" "),e("p",[t._v("Android（4.2+）提供了 addJavascriptInterface 注入")]),t._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 注入全局JS对象")]),t._v("\nwebView"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("addJavascriptInterface")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("NativeBridge")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"NativeBridge"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("NativeBridge")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" Context ctx"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("NativeBridge")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("Context ctx")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ctx "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ctx"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 增加JS调用接口")]),t._v("\n  @JavascriptInterface\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("showNativeDialog")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("String text")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AlertDialog"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Builder")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("setMessage")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("text"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("create")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("show")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br"),e("span",{staticClass:"line-number"},[t._v("14")]),e("br"),e("span",{staticClass:"line-number"},[t._v("15")]),e("br")])]),e("hr"),t._v(" "),e("p",[t._v("参考：JSBridge 的原理 "),e("a",{attrs:{href:"https://www.cnblogs.com/dailc/p/5931324.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.cnblogs.com/dailc/p/5931324.html"),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("聊一聊桥接（JSBridge）的原理 "),e("a",{attrs:{href:"https://www.likecs.com/show-129596.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.likecs.com/show-129596.html"),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("JSBridge 的实现原理 "),e("a",{attrs:{href:"https://segmentfault.com/a/1190000020303655",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://segmentfault.com/a/1190000020303655"),e("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=n.exports}}]);