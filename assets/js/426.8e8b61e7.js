(window.webpackJsonp=window.webpackJsonp||[]).push([[426],{895:function(t,s,a){"use strict";a.r(s);var n=a(20),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"同源策略"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#同源策略"}},[t._v("#")]),t._v(" 同源策略")]),t._v(" "),a("p",[t._v("同源：协议、域名、端口相同")]),t._v(" "),a("h3",{attrs:{id:"同源策略的限制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#同源策略的限制"}},[t._v("#")]),t._v(" 同源策略的限制")]),t._v(" "),a("p",[t._v("同源策略限制以下几种行为：")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("Cookie、LocalStorage 和 IndexDB 无法读取")])]),t._v(" "),a("li",[a("p",[t._v("DOM 和 Js 对象无法获得")])]),t._v(" "),a("li",[a("p",[t._v("AJAX 请求不能发送")])])]),t._v(" "),a("h2",{attrs:{id:"跨域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#跨域"}},[t._v("#")]),t._v(" 跨域")]),t._v(" "),a("p",[t._v("当一个请求 url 的协议、域名、端口三者之间任意一个与当前页面 url 不同即为跨域")]),t._v(" "),a("p",[t._v("跨域的解决办法：")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("通过 jsonp 跨域")])]),t._v(" "),a("li",[a("p",[t._v("跨域资源共享（CORS）")])]),t._v(" "),a("li",[a("p",[t._v("nginx 代理跨域")])]),t._v(" "),a("li",[a("p",[t._v("nodejs 中间件代理跨域")])]),t._v(" "),a("li",[a("p",[t._v("postMessage 跨域")])]),t._v(" "),a("li",[a("p",[t._v("WebSocket协议跨域")])])]),t._v(" "),a("h3",{attrs:{id:"jsonp-跨域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jsonp-跨域"}},[t._v("#")]),t._v(" jsonp 跨域")]),t._v(" "),a("p",[t._v("script 标签的 src，img 标签的 src，link 标签的 href 没有被同源策略所限制")]),t._v(" "),a("p",[t._v("原理：动态创建一个"),a("code",[t._v("<script>")]),t._v("标签，而 script 标签的 src 属性是没有跨域的限制的。,src 中放入链接和回调方法。")]),t._v(" "),a("p",[t._v("优点：兼容性好")]),t._v(" "),a("p",[t._v("缺点：只支持 get 请求，不支持 post 请求。")]),t._v(" "),a("p",[t._v("代码实现：")]),t._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("button")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("id")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("btn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("点击"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("button")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}}),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}},[a("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"#btn"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("click")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" frame "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"script"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    frame"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://localhost:3000/article-list?name=leo&age=30&callback=func"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"body"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("append")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("frame"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("func")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("res")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("message "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"你已经"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("age "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"岁了"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br")])]),a("h3",{attrs:{id:"跨域资源共享-cors"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#跨域资源共享-cors"}},[t._v("#")]),t._v(" 跨域资源共享（CORS）")]),t._v(" "),a("p",[t._v("普通跨域请求：只服务端设置 Access-Control-Allow-Origin 即可，前端无须设置")]),t._v(" "),a("p",[t._v("若要带 cookie 请求：前后端都需要设置。")]),t._v(" "),a("p",[t._v("前端设置")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("ajax 设置："),a("code",[t._v("xhr.withCredentials = true; // 跨域请求是否提供凭据信息(cookie、HTTP认证及客户端SSL证明等)")])])]),t._v(" "),a("li",[a("p",[t._v("axios 设置："),a("code",[t._v("axios.defaults.withCredentials = true")])])])]),t._v(" "),a("p",[t._v("服务器端设置：")]),t._v(" "),a("p",[t._v("允许前端带认证 cookie：启用此项后，上面的域名不能为'*'，必须指定具体的域名")]),t._v(" "),a("p",[a("code",[t._v("Access-Control-Allow-Credentials: true")])]),t._v(" "),a("p",[t._v("允许跨域访问的域名：若有端口需写全（协议+域名+端口），若没有端口末尾不用加'/'")]),t._v(" "),a("p",[a("code",[t._v("Access-Control-Allow-Origin: http://www.domain1.com")])]),t._v(" "),a("h3",{attrs:{id:"nginx-代理跨域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-代理跨域"}},[t._v("#")]),t._v(" nginx 代理跨域")]),t._v(" "),a("p",[t._v("跨域原理： 同源策略是浏览器的安全策略，不是 HTTP 协议的一部分。服务器端调用 HTTP 接口只是使用 HTTP 协议，不会执行 JS 脚本，不需要同源策略，也就不存在跨越问题")]),t._v(" "),a("p",[t._v("实现思路：通过 nginx 配置一个代理服务器（域名与 domain1 相同，端口不同）做跳板机，反向代理访问 domain2 接口，并且可以顺便修改 cookie 中 domain 信息，方便当前域 cookie 写入，实现跨域登录。")]),t._v(" "),a("ol",[a("li",[t._v("可在 nginx 的静态资源服务器中加入以下配置")])]),t._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("location / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  add_header Access-Control-Allow-Origin *"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("h3",{attrs:{id:"nodejs-中间件代理跨域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nodejs-中间件代理跨域"}},[t._v("#")]),t._v(" nodejs 中间件代理跨域")]),t._v(" "),a("p",[t._v("原理大致与 nginx 相同，都是通过启一个代理服务器，实现数据的转发，也可以通过设置 cookieDomainRewrite 参数修改响应头中 cookie 中域名，实现当前域的 cookie 写入，方便接口登录认证。")]),t._v(" "),a("p",[t._v("非vue框架的跨域（2次跨域）:")]),t._v(" "),a("p",[t._v("利用node + express + http-proxy-middleware搭建一个proxy服务器。")]),t._v(" "),a("p",[t._v("vue 框架的跨域（1次跨域）:")]),t._v(" "),a("p",[t._v("利用 node + webpack + webpack-dev-server 代理接口跨域。在开发环境下，由于 vue 渲染服务和接口代理服务都是 webpack-dev-server 同一个，所以页面与代理接口之间不再跨域，无须设置 headers 跨域信息了。")]),t._v(" "),a("h3",{attrs:{id:"postmessage-跨域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#postmessage-跨域"}},[t._v("#")]),t._v(" postMessage 跨域")]),t._v(" "),a("p",[t._v("postMessage 是 HTML5 中的 API，且是可以跨域操作的 window 属性")]),t._v(" "),a("p",[t._v("作用：")]),t._v(" "),a("ol",[a("li",[t._v("页面和其打开的新窗口的数据传递")]),t._v(" "),a("li",[t._v("多窗口之间消息传递")]),t._v(" "),a("li",[t._v("页面与嵌套的 iframe 消息传递")]),t._v(" "),a("li",[t._v("上面三个场景的跨域数据传递")])]),t._v(" "),a("p",[t._v("语法："),a("code",[t._v("postMessage(data,origin)")])]),t._v(" "),a("ol",[a("li",[a("p",[t._v("data： html5规范支持任意基本类型或可复制的对象，但部分浏览器只支持字符串，所以传参时最好用JSON.stringify()序列化。")])]),t._v(" "),a("li",[a("p",[t._v('origin： 协议+主机+端口号，也可以设置为"*"，表示可以传递给任意窗口，如果要指定和当前窗口同源的话设置为"/"。')])])]),t._v(" "),a("h3",{attrs:{id:"websocket协议跨域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#websocket协议跨域"}},[t._v("#")]),t._v(" WebSocket协议跨域")]),t._v(" "),a("p",[t._v("WebSocket protocol是HTML5一种新的协议。它实现了浏览器与服务器全双工通信，同时允许跨域通讯，是server push技术的一种很好的实现。")]),t._v(" "),a("h3",{attrs:{id:"document-domain-iframe跨域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#document-domain-iframe跨域"}},[t._v("#")]),t._v(" document.domain + iframe跨域")]),t._v(" "),a("p",[t._v("此方案仅限主域相同，子域不同的跨域应用场景。")]),t._v(" "),a("p",[t._v("实现原理：两个页面都通过js强制设置document.domain为基础主域，就实现了同域。")])])}),[],!1,null,null,null);s.default=e.exports}}]);